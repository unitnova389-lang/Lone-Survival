-- Admin LocalScript: Rainbow Outline Highlight + Health & Username
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer
local playersFolder = Workspace:WaitForChild("Players")

-- Rainbow color function
local function getRainbowColor()
    return Color3.fromHSV(tick()%5/5,1,1)
end

-- Create highlight and GUI for a model
local function applyHighlight(model)
    if not model or not model:IsA("Model") then return end
    if model:FindFirstChild("Admin_Highlight") then return end

    -- Highlight
    local hl = Instance.new("Highlight")
    hl.Name = "Admin_Highlight"
    hl.FillColor = Color3.fromRGB(0,0,0)
    hl.FillTransparency = 0.4
    hl.OutlineColor = Color3.fromRGB(255,0,0) -- temporary
    hl.OutlineTransparency = 0
    hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    hl.Parent = model

    -- Get humanoid and root
    local humanoid = model:FindFirstChildWhichIsA("Humanoid")
    local root = model:FindFirstChild("HumanoidRootPart") or model:FindFirstChild("Torso")
    if not humanoid or not root then return end

    -- Billboard GUI for Health (above) and Username (below)
    local gui = Instance.new("BillboardGui")
    gui.Name = "Admin_InfoGui"
    gui.Adornee = root
    gui.Size = UDim2.new(0,150,0,50)
    gui.StudsOffset = Vector3.new(0,3,0)
    gui.AlwaysOnTop = true
    gui.Parent = model

    -- Health text (above)
    local healthText = Instance.new("TextLabel")
    healthText.Size = UDim2.new(1,0,0.5,0)
    healthText.Position = UDim2.new(0,0,0,0)
    healthText.BackgroundTransparency = 1
    healthText.TextColor3 = Color3.fromRGB(0,255,0)
    healthText.TextStrokeTransparency = 0
    healthText.TextScaled = true
    healthText.Text = string.format("HP: %.0f/%.0f", humanoid.Health, humanoid.MaxHealth)
    healthText.Parent = gui

    -- Username text (below)
    local nameText = Instance.new("TextLabel")
    nameText.Size = UDim2.new(1,0,0.5,0)
    nameText.Position = UDim2.new(0,0,0.5,0)
    nameText.BackgroundTransparency = 1
    nameText.TextColor3 = Color3.fromRGB(255,255,255)
    nameText.TextStrokeTransparency = 0
    nameText.TextScaled = true
    nameText.Text = model.Name
    nameText.Parent = gui

    -- Update every frame
    RunService.RenderStepped:Connect(function()
        if humanoid and humanoid.Health > 0 then
            healthText.Text = string.format("HP: %.0f/%.0f", humanoid.Health, humanoid.MaxHealth)
            hl.OutlineColor = getRainbowColor()
        end
    end)

    -- Cleanup on death
    humanoid.Died:Connect(function()
        if gui then gui:Destroy() end
        if hl then hl:Destroy() end
    end)
end

-- Apply to all existing models
for _, model in pairs(playersFolder:GetChildren()) do
    if model ~= localPlayer.Character then
        task.spawn(function()
            task.wait(0.1)
            applyHighlight(model)
        end)
    end
end

-- Apply to new models
playersFolder.ChildAdded:Connect(function(model)
    if model ~= localPlayer.Character then
        task.wait(0.1)
        applyHighlight(model)
    end
end)
