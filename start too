-- LocalScript in StarterPlayerScripts
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")

-- Highlight setup
local function applyHighlight(viewmodel)
	if not viewmodel:FindFirstChild("CustomHighlight") then
		local hl = Instance.new("Highlight")
		hl.Name = "CustomHighlight"
		hl.Adornee = viewmodel
		hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
		hl.FillColor = Color3.fromRGB(0, 0, 0)
		hl.FillTransparency = 0.9
		hl.OutlineColor = Color3.fromRGB(255, 255, 255)
		hl.OutlineTransparency = 0
		hl.Parent = viewmodel
	end
end

-- Arm setup
local function applyArmChanges(viewmodel)
	local parts = {
		"LeftHand", "LeftLowerArm", "LeftUpperArm",
		"RightHand", "RightLowerArm", "RightUpperArm"
	}
	for _, partName in ipairs(parts) do
		local part = viewmodel:FindFirstChild(partName)
		if part and part:IsA("BasePart") then
			part.Material = Enum.Material.ForceField
			part.Color = Color3.fromRGB(202, 203, 209)
		end
	end
end

-- Extra models setup
local function applyExtraModels(viewmodel)
	for _, child in ipairs(viewmodel:GetChildren()) do
		-- skip arms
		if not table.find({
			"LeftHand","LeftLowerArm","LeftUpperArm",
			"RightHand","RightLowerArm","RightUpperArm"
		}, child.Name) then
			-- process all descendants
			for _, descendant in ipairs(child:GetDescendants()) do
				if descendant:IsA("BasePart") then
					descendant.Material = Enum.Material.Neon
					descendant.Transparency = 0.5
					descendant.Color = Color3.fromRGB(0, 0, 0)
				elseif descendant:IsA("SurfaceAppearance") then
					descendant:Destroy()
				end
			end
		end
	end
end

-- Apply everything
local function setupViewmodel(vm)
	if vm then
		applyHighlight(vm)
		applyArmChanges(vm)
		applyExtraModels(vm)
	end
end

-- Watch for Viewmodel
local function watchCamera()
	local cam = Workspace.CurrentCamera
	if not cam then return end

	if cam:FindFirstChild("Viewmodel") then
		setupViewmodel(cam.Viewmodel)
	end

	cam.ChildAdded:Connect(function(child)
		if child.Name == "Viewmodel" then
			setupViewmodel(child)
		end
	end)
end

watchCamera()
